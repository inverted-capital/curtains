import{g as An,c as Q,D as wn,b as Cn,O as On,a as I,_ as Sn,p as In}from"./index-lNgwdCew.js";import{i as Bt}from"./io-hooks-DptC7XeV.js";var k={exports:{}};k.exports;(function(c,p){var _=200,l="__lodash_hash_undefined__",g=800,T=16,y=9007199254740991,A="[object Arguments]",U="[object Array]",B="[object AsyncFunction]",G="[object Boolean]",L="[object Date]",H="[object Error]",P="[object Function]",tt="[object GeneratorFunction]",R="[object Map]",et="[object Number]",w="[object Null]",b="[object Object]",x="[object Proxy]",Ht="[object RegExp]",Vt="[object Set]",Kt="[object String]",Jt="[object Undefined]",$t="[object WeakMap]",Wt="[object ArrayBuffer]",Yt="[object DataView]",Zt="[object Float32Array]",qt="[object Float64Array]",Qt="[object Int8Array]",Xt="[object Int16Array]",kt="[object Int32Array]",te="[object Uint8Array]",ee="[object Uint8ClampedArray]",ne="[object Uint16Array]",re="[object Uint32Array]",ae=/[\\^$.*+?()[\]{}|]/g,ie=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,s={};s[Zt]=s[qt]=s[Qt]=s[Xt]=s[kt]=s[te]=s[ee]=s[ne]=s[re]=!0,s[A]=s[U]=s[Wt]=s[G]=s[Yt]=s[L]=s[H]=s[P]=s[R]=s[et]=s[b]=s[Ht]=s[Vt]=s[Kt]=s[$t]=!1;var dt=typeof Q=="object"&&Q&&Q.Object===Object&&Q,se=typeof self=="object"&&self&&self.Object===Object&&self,D=dt||se||Function("return this")(),gt=p&&!p.nodeType&&p,N=gt&&!0&&c&&!c.nodeType&&c,_t=N&&N.exports===gt,nt=_t&&dt.process,yt=function(){try{var t=N&&N.require&&N.require("util").types;return t||nt&&nt.binding&&nt.binding("util")}catch{}}(),bt=yt&&yt.isTypedArray;function ue(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function fe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function ce(t){return function(e){return t(e)}}function le(t,e){return t==null?void 0:t[e]}function pe(t,e){return function(n){return t(e(n))}}var he=Array.prototype,de=Function.prototype,V=Object.prototype,rt=D["__core-js_shared__"],K=de.toString,m=V.hasOwnProperty,mt=function(){var t=/[^.]+$/.exec(rt&&rt.keys&&rt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),vt=V.toString,ge=K.call(Object),_e=RegExp("^"+K.call(m).replace(ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),J=_t?D.Buffer:void 0,Tt=D.Symbol,At=D.Uint8Array,wt=J?J.allocUnsafe:void 0,Ct=pe(Object.getPrototypeOf,Object),Ot=Object.create,ye=V.propertyIsEnumerable,be=he.splice,C=Tt?Tt.toStringTag:void 0,$=function(){try{var t=ot(Object,"defineProperty");return t({},"",{}),t}catch{}}(),me=J?J.isBuffer:void 0,St=Math.max,ve=Date.now,It=ot(D,"Map"),z=ot(Object,"create"),Te=function(){function t(){}return function(e){if(!S(e))return{};if(Ot)return Ot(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function O(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ae(){this.__data__=z?z(null):{},this.size=0}function we(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Ce(t){var e=this.__data__;if(z){var n=e[t];return n===l?void 0:n}return m.call(e,t)?e[t]:void 0}function Oe(t){var e=this.__data__;return z?e[t]!==void 0:m.call(e,t)}function Se(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=z&&e===void 0?l:e,this}O.prototype.clear=Ae,O.prototype.delete=we,O.prototype.get=Ce,O.prototype.has=Oe,O.prototype.set=Se;function v(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ie(){this.__data__=[],this.size=0}function xe(t){var e=this.__data__,n=W(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():be.call(e,n,1),--this.size,!0}function je(t){var e=this.__data__,n=W(e,t);return n<0?void 0:e[n][1]}function Ee(t){return W(this.__data__,t)>-1}function Pe(t,e){var n=this.__data__,r=W(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}v.prototype.clear=Ie,v.prototype.delete=xe,v.prototype.get=je,v.prototype.has=Ee,v.prototype.set=Pe;function j(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Re(){this.size=0,this.__data__={hash:new O,map:new(It||v),string:new O}}function De(t){var e=Z(this,t).delete(t);return this.size-=e?1:0,e}function Ne(t){return Z(this,t).get(t)}function ze(t){return Z(this,t).has(t)}function Fe(t,e){var n=Z(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}j.prototype.clear=Re,j.prototype.delete=De,j.prototype.get=Ne,j.prototype.has=ze,j.prototype.set=Fe;function E(t){var e=this.__data__=new v(t);this.size=e.size}function Me(){this.__data__=new v,this.size=0}function Ue(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Be(t){return this.__data__.get(t)}function Ge(t){return this.__data__.has(t)}function Le(t,e){var n=this.__data__;if(n instanceof v){var r=n.__data__;if(!It||r.length<_-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new j(r)}return n.set(t,e),this.size=n.size,this}E.prototype.clear=Me,E.prototype.delete=Ue,E.prototype.get=Be,E.prototype.has=Ge,E.prototype.set=Le;function He(t,e){var n=ft(t),r=!n&&ut(t),i=!n&&!r&&Rt(t),o=!n&&!r&&!i&&Nt(t),u=n||r||i||o,a=u?fe(t.length,String):[],f=a.length;for(var d in t)(e||m.call(t,d))&&!(u&&(d=="length"||i&&(d=="offset"||d=="parent")||o&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||Et(d,f)))&&a.push(d);return a}function at(t,e,n){(n!==void 0&&!q(t[e],n)||n===void 0&&!(e in t))&&it(t,e,n)}function Ve(t,e,n){var r=t[e];(!(m.call(t,e)&&q(r,n))||n===void 0&&!(e in t))&&it(t,e,n)}function W(t,e){for(var n=t.length;n--;)if(q(t[n][0],e))return n;return-1}function it(t,e,n){e=="__proto__"&&$?$(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var Ke=rn();function Y(t){return t==null?t===void 0?Jt:w:C&&C in Object(t)?an(t):ln(t)}function xt(t){return F(t)&&Y(t)==A}function Je(t){if(!S(t)||fn(t))return!1;var e=lt(t)?_e:ie;return e.test(gn(t))}function $e(t){return F(t)&&Dt(t.length)&&!!s[Y(t)]}function We(t){if(!S(t))return cn(t);var e=Pt(t),n=[];for(var r in t)r=="constructor"&&(e||!m.call(t,r))||n.push(r);return n}function jt(t,e,n,r,i){t!==e&&Ke(e,function(o,u){if(i||(i=new E),S(o))Ye(t,e,u,n,jt,r,i);else{var a=r?r(st(t,u),o,u+"",t,e,i):void 0;a===void 0&&(a=o),at(t,u,a)}},zt)}function Ye(t,e,n,r,i,o,u){var a=st(t,n),f=st(e,n),d=u.get(f);if(d){at(t,n,d);return}var h=o?o(a,f,n+"",t,e,u):void 0,M=h===void 0;if(M){var pt=ft(f),ht=!pt&&Rt(f),Mt=!pt&&!ht&&Nt(f);h=f,pt||ht||Mt?ft(a)?h=a:_n(a)?h=tn(a):ht?(M=!1,h=Qe(f,!0)):Mt?(M=!1,h=ke(f,!0)):h=[]:yn(f)||ut(f)?(h=a,ut(a)?h=bn(a):(!S(a)||lt(a))&&(h=on(f))):M=!1}M&&(u.set(f,h),i(h,f,r,o,u),u.delete(f)),at(t,n,h)}function Ze(t,e){return hn(pn(t,e,Ft),t+"")}var qe=$?function(t,e){return $(t,"toString",{configurable:!0,enumerable:!1,value:vn(e),writable:!0})}:Ft;function Qe(t,e){if(e)return t.slice();var n=t.length,r=wt?wt(n):new t.constructor(n);return t.copy(r),r}function Xe(t){var e=new t.constructor(t.byteLength);return new At(e).set(new At(t)),e}function ke(t,e){var n=e?Xe(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function tn(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function en(t,e,n,r){var i=!n;n||(n={});for(var o=-1,u=e.length;++o<u;){var a=e[o],f=r?r(n[a],t[a],a,n,t):void 0;f===void 0&&(f=t[a]),i?it(n,a,f):Ve(n,a,f)}return n}function nn(t){return Ze(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,u=i>2?n[2]:void 0;for(o=t.length>3&&typeof o=="function"?(i--,o):void 0,u&&sn(n[0],n[1],u)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,o)}return e})}function rn(t){return function(e,n,r){for(var i=-1,o=Object(e),u=r(e),a=u.length;a--;){var f=u[t?a:++i];if(n(o[f],f,o)===!1)break}return e}}function Z(t,e){var n=t.__data__;return un(e)?n[typeof e=="string"?"string":"hash"]:n.map}function ot(t,e){var n=le(t,e);return Je(n)?n:void 0}function an(t){var e=m.call(t,C),n=t[C];try{t[C]=void 0;var r=!0}catch{}var i=vt.call(t);return r&&(e?t[C]=n:delete t[C]),i}function on(t){return typeof t.constructor=="function"&&!Pt(t)?Te(Ct(t)):{}}function Et(t,e){var n=typeof t;return e=e??y,!!e&&(n=="number"||n!="symbol"&&oe.test(t))&&t>-1&&t%1==0&&t<e}function sn(t,e,n){if(!S(n))return!1;var r=typeof e;return(r=="number"?ct(n)&&Et(e,n.length):r=="string"&&e in n)?q(n[e],t):!1}function un(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function fn(t){return!!mt&&mt in t}function Pt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||V;return t===n}function cn(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}function ln(t){return vt.call(t)}function pn(t,e,n){return e=St(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=St(r.length-e,0),u=Array(o);++i<o;)u[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(u),ue(t,this,a)}}function st(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var hn=dn(qe);function dn(t){var e=0,n=0;return function(){var r=ve(),i=T-(r-n);if(n=r,i>0){if(++e>=g)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function gn(t){if(t!=null){try{return K.call(t)}catch{}try{return t+""}catch{}}return""}function q(t,e){return t===e||t!==t&&e!==e}var ut=xt(function(){return arguments}())?xt:function(t){return F(t)&&m.call(t,"callee")&&!ye.call(t,"callee")},ft=Array.isArray;function ct(t){return t!=null&&Dt(t.length)&&!lt(t)}function _n(t){return F(t)&&ct(t)}var Rt=me||Tn;function lt(t){if(!S(t))return!1;var e=Y(t);return e==P||e==tt||e==B||e==x}function Dt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=y}function S(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function F(t){return t!=null&&typeof t=="object"}function yn(t){if(!F(t)||Y(t)!=b)return!1;var e=Ct(t);if(e===null)return!0;var n=m.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&K.call(n)==ge}var Nt=bt?ce(bt):$e;function bn(t){return en(t,zt(t))}function zt(t){return ct(t)?He(t,!0):We(t)}var mn=nn(function(t,e,n){jt(t,e,n)});function vn(t){return function(){return t}}function Ft(t){return t}function Tn(){return!1}c.exports=mn})(k,k.exports);var xn=k.exports;const Ut=An(xn);var jn={VITE_OPENAI_API_KEY:"c2stVWRlRWFIWWZxQVBkQ1czZVNuTmFUM0JsYmtGSkRSTnp5cW9rRjFmR0ZBdE80Sm9S",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const X=wn("AI:isolates:chat"),En="gpt-4-1106-preview",{VITE_OPENAI_API_KEY:Gt}=jn;if(!Gt)throw new Error("missing openai api key");const Pn=Cn.Buffer.from(Gt,"base64").toString("utf-8"),Rn=new On({apiKey:Pn,dangerouslyAllowBrowser:!0}),Mn={prompt:{description:"prompt the AI",type:"object",properties:{text:{description:"the text to prompt the AI with",type:"string"},noSysPrompt:{type:"boolean"}}}},Un={prompt:async({text:c,noSysPrompt:p=!1})=>{I(typeof c=="string","text must be a string"),I(c.length,"text must not be empty");const _=Bt();let l=[];const g="/chat-1.session.json";if(await _.isFile(g)&&(l=await _.readJS(g)),I(Array.isArray(l),"messages must be an array"),!p){const{default:y}=await Sn(()=>import("./curtains-Aw3dsg9n.js"),__vite__mapDeps([])),A=y.instructions.join(`
`).trim();l.shift(),l.unshift({role:"system",content:A})}c&&l.push({role:"user",content:c});const T=await Lt(l,g);return X("assistant",T),T},engage:async({helpPath:c},p)=>{}},Dn=c=>{try{return JSON.parse(c),!0}catch{return!1}},Lt=async(c,p)=>{var y,A,U,B,G,L,H;const _={model:En,temperature:0,messages:[...c],stream:!0,seed:1337},l={role:"assistant"};c.push(l);const g=Bt();await g.writeJS(c,p),X("streamCall started");const T=await Rn.chat.completions.create(_);X("streamCall placed");for await(const P of T){const tt=((A=(y=P.choices[0])==null?void 0:y.delta)==null?void 0:A.content)||"";l.content||(l.content=""),l.content+=tt;const R=(B=(U=P.choices[0])==null?void 0:U.delta)==null?void 0:B.tool_calls;if(R){I(Array.isArray(R),"toolCalls must be an array"),l.toolCalls||(l.toolCalls=[]);for(const et of R){let{index:w,...b}=et;I(Number.isInteger(w),"toolCalls index must be an integer");let x=((L=(G=l.toolCalls[w])==null?void 0:G.function)==null?void 0:L.arguments)||"";x+=((H=b==null?void 0:b.function)==null?void 0:H.arguments)||"",x&&Dn(x)&&(l.toolCalls[w]||(l.toolCalls[w]={}),b=Ut({},b,{function:{arguments:JSON.parse(x)}}),Ut(l.toolCalls[w],b))}}await g.writeJS(c,p)}return X("streamCall complete"),Nn(c,p)},Nn=async(c,p)=>{I(Array.isArray(c),"messages must be an array"),I(In.isAbsolute(p),"sessionPath must be absolute");const _=c[c.length-1];if(!_.toolCalls)return _.content;for(const l of _.toolCalls){const{function:g,arguments:T}=l;await io(path,g,T);const y=await fs.call(g,arguments);l.result=y}return Lt(c,p)};export{Mn as api,Un as functions};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
